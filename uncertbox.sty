\ProvidesPackage{uncertbox}

\usepackage{tikz}
\usepackage{pgfplots}
\usetikzlibrary{calc}

\newcommand{\prepareuncertbox}{
    % Define axis coordinates for foreach
    \coordinate (O) at (axis cs:0,0);
    \coordinate (X) at (axis cs:1,0);
    \coordinate (Y) at (axis cs:0,1);
}

% Options: 
% Number of data points
% X column
% Y column
% dX
% dY
\newcommand{\makeuncertboxes}[5] {
    \begin{scope}[x={($(X)-(O)$)}, y={($(Y)-(O)$)}, shift={(O)}]
        \foreach \row in {0,1,..., \numexpr#1 - 1} {
            \pgfplotstablegetelem{\row}{#2}\of\table
            \let\x=\pgfplotsretval
            \pgfplotstablegetelem{\row}{#3}\of\table
            \let\y=\pgfplotsretval
            \pgfplotstablegetelem{\row}{#4}\of\table
            \let\dx=\pgfplotsretval
            \pgfplotstablegetelem{\row}{#5}\of\table
            \let\dy=\pgfplotsretval
            \draw (\x + \dx, \y + \dy) -- (\x + \dx, \y - \dy) -- (\x - \dx, \y - \dy) -- (\x - \dx, \y + \dy) -- cycle;
        }
    \end{scope}
}